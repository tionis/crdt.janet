<!DOCTYPE html> <html data-lt-installed=true data-darkreader-mode=dynamic data-darkreader-scheme=dark style lang=en-US><!--
 Page saved with SingleFile 
 url: https://mattweidner.com/2023/04/13/position-strings.html 
 saved date: Sun Jun 18 2023 01:09:52 GMT+0200 (Central European Summer Time)
--><meta charset=utf-8><style class="darkreader darkreader--user-agent" media=screen>.jfk-bubble.gtx-bubble,.captcheck_answer_label>input+img,span#closed_text>img[src^="https://www.gstatic.com/images/branding/googlelogo"],span[data-href^="https://www.hcaptcha.com/"]>#icon,#bit-notification-bar-iframe,::-webkit-calendar-picker-indicator{filter:invert(100%) hue-rotate(180deg) contrast(90%)!important}[data-darkreader-inline-color]{color:var(--darkreader-inline-color)!important}:root{--darkreader-neutral-background:#131516;--darkreader-neutral-text:#d8d4cf;--darkreader-selection-background:#004daa;--darkreader-selection-text:#e8e6e3}html{background-color:#181a1b!important}html{color-scheme:dark!important}html,body{background-color:#181a1b}html,body{border-color:#736b5e;color:#e8e6e3}a{color:#3391ff}::placeholder{color:#b2aba1}::-webkit-scrollbar{background-color:#202324;color:#aba499}::-webkit-scrollbar-thumb{background-color:#454a4d}::-webkit-scrollbar-corner{background-color:#181a1b}*{scrollbar-color:#454a4d #202324}::selection{background-color:#004daa!important;color:#e8e6e3!important}::-moz-selection{background-color:#004daa!important;color:#e8e6e3!important}</style>
<meta name=viewport content="width=device-width, initial-scale=1">
<meta name=keywords content="position-strings, collaborative text editing, CRDTs, fractional indexing, Fugue">
<title>"Position Strings" for Collaborative Lists and Text - Matthew Weidner</title>
<style>body{background:#fff;color:#34495e;font-family:"PT Serif",Athelas,STHeiti,serif;line-height:1.5}.plainA{text-decoration:none;color:inherit}blockquote{margin:2em 0;padding:10px 20px;position:relative;color:rgba(52,73,94,0.8);background-color:rgba(192,91,77,0.05);border-left:3px solid rgba(192,91,77,0.3);box-shadow:1px 1px 2px rgba(0,0,0,0.125)}blockquote p{margin:0}blockquote+p{margin:-1.5em 0 1.5em 0;text-align:right}li{margin-bottom:10pt}.footnotes{font-size:14px;color:gray}.footnotes p{margin:10px}.highlight{background:#e6e6e6;border:1px #C1C1C1;border-radius:3px;padding:3px}.highlight .k{color:#008000;font-weight:bold}.highlight .o{color:#303030}.highlight .c1{color:#808080}.highlight .kd{color:#008000;font-weight:bold}.highlight .na{color:#0000C0}.highlight .s2{background-color:#fff0f0}.highlight .s1{background-color:#fff0f0}</style><style class="darkreader darkreader--sync" media=screen>body{background-color:rgb(24,26,27);background-image:none;color:rgb(166,188,206)}.plainA{text-decoration-color:currentcolor;color:inherit}blockquote{color:rgba(166,188,206,0.8);background-color:rgba(144,62,51,0.05);border-left-color:rgba(129,56,46,0.3);box-shadow:rgba(0,0,0,0.13) 1px 1px 2px}.footnotes{color:rgb(152,143,129)}.highlight{background-color:rgb(38,41,43);background-image:none;border-color:rgb(66,71,74)}.highlight .k{color:rgb(114,255,114)}.highlight .o{color:rgb(202,197,190)}.highlight .c1{color:rgb(152,143,129)}.highlight .kd{color:rgb(114,255,114)}.highlight .na{color:rgb(89,149,255)}.highlight .s2{background-color:rgb(60,0,0)}.highlight .s1{background-color:rgb(60,0,0)}</style>
<meta name=darkreader content=cb29a22310ba40698758e0009b4102e3><style class="darkreader darkreader--override" media=screen>::placeholder{opacity:0.5!important}</style><link rel=icon type=image/x-icon href="data:image/vnd.microsoft.icon;base64,AAABAAEAICAAAAEAIACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB7go7/jpah/4+Wof+SmKL/lJul/5Kapv+SmKH/k5ef/5GUm/+Ok5r/jZKZ/4qPl/+IjZX/io+X/4ySmv+HjZX/h42V/4eOl/+HjZb/jJCW/4mOlv+QlJr/io+X/4qOlf+boKj/i5Ga/4+UnP+PlZ3/ho2W/3h/iv9DTF//Pkpi/4uTn/+Sl6L/mJ2m/4+Wof+TmqX/kJeh/5KWnv+Slp7/jpOb/4yRmf+Kj5f/iI6W/4iMlP+Kj5X/iI6W/4aLkv+EipH/iIyT/4aLkf+HjJT/jpOb/4aMkv+JkJn/n5ud/5eWmv+KkJf/jpOb/4yRmP+Ok5r/ipCY/3yCiv9LUWD/jZWg/5GWof+Vm6X/kZei/5aaov+TmKD/mp2l/5GVnf+LkJj/iI6W/4eNlf+JjZP/i46U/4SIj/+EiY//g4iO/4SJj/+EiY//h4uR/5aWmf+QkZX/iY6U/4aMlP+Nj5X/jpGX/42Smv+Ok5z/jJGY/4qPmP+QlqD/jJOd/4eNlv+ZnKb/l5ul/5OZo/+XnKb/k5ii/5GWnv+opqr/jpOb/4uQmP+HjJP/houS/4eLkf+Hio//h4uR/4OHjf+Dh43/gIWM/4GGjP+HipD/hImP/4SJj/+EiZD/houS/4iMk/+HjJL/hoyS/4uPlv+Pk5n/jJOd/4+UnP+VmqL/jJOc/6uorv+zra//lJmj/5acp/+Sl6H/lpqh/4+UnP+Nkpr/iI2U/4eNlP+Gi5H/houS/4OIjf+Bhoz/f4SK/4CFi/9/hIv/gYaM/4GGjP+Bhoz/goeN/4KIkP+EiY//hYqR/4eMkv+Gi5H/iI2T/4eMk/+Mkpz/jZGZ/5CVnP+Rlp//l5yn/5idqP+Vm6X/lpyn/5ebpf+ZnaX/j5Wd/42Smv+KjpT/h4uT/4WKkP+DiI7/f4SK/36Eiv99goj/gIWK/4CFi/+Ahoz/gIaM/4GHjP+AhYv/gIWL/4CFi/+EipD/hYqQ/4uPlv+LkJj/iY+X/4uRmv+VmaD/j5Sc/46Unv+VnKj/lZyp/5Sbp/+Xnaj/mZ2m/5OYov+QlZ3/jpOa/4iNlP+Hi5L/goeN/4CEiv9/hIn/fYKI/3yBhv9+gof/f4OH/4WHiv9+g4n/fIGH/32DiP9+g4n/gIWL/4GGjP+FiY//hYuS/46Vof+LlaL/iY6V/4+Tmv+XmJ3/lpie/5qgrf+coa7/mZ+q/5qhrv+Ynqn/lZqk/5OXoP+PlJv/iY2U/4WKkP+Bhov/f4OI/3yAhv96foP/eX2D/3l9g/96foT/foGG/4mKjf9+hIj/fYKI/36Dif+CiI7/goaM/4iMkf+Hi5H/iIyT/4qPmP+Jj5b/ipCZ/4yRmP+Jj5b/nqSx/6KpuP+hqrz/oKWx/6Ckr/+Ynqj/lpuk/5CVnv+Lj5f/hYmQ/4GFiv98gIb/eHyB/3l8gf93e3//eHuB/3h8gf95foP/fICF/3p/hP99goj/hYiM/4CEiv+Ijpb/g4iP/4aLkP+GipD/jpKY/4yQl/+Lj5b/i5CY/4mOlf+iqLf/paq5/6qtuP+qr7z/p6y5/6Ckr/+Ynaf/mJyl/5SXn/+Lj5T/hIqS/26JsP9fg7r/Y4Gw/3aCkf95e3//d3t//3l+g/97f4X/e4CF/3uBif98gYf/gIWL/4OIjv+DiZL/hIyZ/4SJkP+Klab/iY6W/4iNlP+Woa//i5CY/8G9xP+ussH/srfH/7/Azv+usb3/o6ex/6Giqv+kpKr/kJKY/4CRqv85juL/AILn/wB54P8Ab9b/H23K/2+DoP95fID/eX2D/3p+g/96f4b/e4CF/4GEif9/hYv/goaL/4aLkP+Ch43/hIiN/4OIjv+GjJT/h4yS/4qPl/+Jj5b/s7fF/7S4xv+3usf/t7vL/6ywvf+pqbH/naCo/5Kdqf96p8n/KJXs/wCN7v8Ah+v/AILn/wB84P8Ab9T/Mm/C/3yDiv95fYP/en+E/3yBhv96f4P/fYKI/4CEif+Bhoz/goeM/4WJj/+Ch4z/hImP/4qNk/+Jjpb/i4+X/4qPlf+lqbb/vr/K/6isuf+rr7v/p6q1/5qdpv+VmJ//gKzM/02i4v8Am/P/AJHw/wCL7f8Ah+r/AIPm/wB63P8AY8b/eIea/3uAhf+KiYv/foOI/3+DiP+BhYr/goaK/4OIjv+FiY//oJmX/4mLkP+Fi5L/hYmP/4uRmf+Lj5b/jJCW/52muP+zuMb/oKe2/6Omsf+bn6n/lpqi/5OVm/98sNT/Jany/xOm9f8AlfL/AI3u/wCJ6/8AhOf/AHre/wdmy/9/h5P/fYKH/4GEif+BhYr/homN/4KGi/+Eh43/hoqO/4eJjv+Ii5D/h42U/4SIjv+FipD/hYqR/4mOlf+IjZT/oKm8/6Wtvf+fprP/oqWu/5mcpP+dn6T/kpWb/36y1/9mvPX/T7b3/wCa8/8Aj/D/AIvs/wCE5/8Ad93/R3TA/4OHjf+Chov/gYaN/4SJjv+Hio7/hIiN/4aJjv+Hi5D/h4yT/4aKkf+Hio//h4qQ/4aMlP+JjJL/iY6W/46Smf+rs8b/p7DB/56jr/+an6n/lpqh/5KWnf+QlJr/iq3K/3i35P9vwfj/AaD0/wCX8f8Aje3/AITn/x132f+AjKT/iIyT/4iMlP+FipD/hYqQ/4iMkv+Hi5H/i46T/42Pkv+JjJH/iY2T/4aKj/+Hi5D/io6V/4eLkf+IjZP/iI6W/620xf+sr7v/mZ6q/5SZo/+Slp7/k5ef/5GVnP+an6b/mai6/zeu8P8BpvX/AJzy/wCT7f84it7/iJm5/5KZqP+VmKD/j5Oa/4yQl/+NkZj/kpWc/5CUnP+QlZ3/kJOa/4+Sl/+Nj5T/jZGX/4qNk/+Hi5D/hoqQ/4iMkv+Lj5b/qLHC/5+mtP+Xnan/j5Wg/4+Unf+PlJz/j5Sc/5CUmf+anKL/jZik/3Chy/9nodL/eZm+/5Sbpv+jq73/nqa2/6Omsv+cn6j/mp2k/4uXqf9gks7/P4rc/zmE2P9Whcb/hJKq/5aYnf+TmJ//jJCW/4qNk/+Mj5X/jZGX/46Tmv+orr7/oqm3/5eeqv+UmaP/kZWc/42Smf+Okpn/kJSZ/5SWm/+Pk5j/j5OZ/4+SmP+QlJz/kpih/5qfqv+an6z/nJ+p/5OWnv9ulL//Gozp/wCE6f8AfeP/AHXc/wBt1P8RaMj/gpCu/5uepP+NkZb/iY2T/4mNk/+JjZX/ipCZ/6Osvf+fprP/mJ6p/46Unf+Ok5v/jpOa/42RmP+OkZf/kJKX/46Rlv+PlJz/jpKY/5GUm/+Okpv/jZKa/4mOlf+JjJL/apXA/wWT8P8Aje7/AIjr/wCE6f8Af+P/AHjc/wBs0f8sZr7/rbLB/5KWnf+NkJf/jZCW/4uQlv+Mkpz/pa7A/5yltP+Xnqv/kpii/42TnP+Ok5v/jZGZ/4+Um/+MkJb/i4+V/4yQl/+KjpT/jZCW/4iNk/+FipH/goeN/3yLmf8hnvD/AJjy/wCP8P8Ai+3/AIfr/wCF6P8AgeP/AHbZ/wBjxv97m8H/lZmh/42RmP+KjpT/jJCX/4qQmP+mr8H/oam5/5ifqv+Vm6b/kZeh/5CVnv+Nkpr/jpOb/4qPl/+JjZT/i4+V/4iPmP+GipH/hYqS/4KHjP9+gof/ZJ7M/wKm9v8BnfT/AJLy/wCN7v8Aiez/AIfp/wCC5f8Aedz/AGjL/2eh1P+Ul5//i5CX/4mOlv+MkZn/i5Ga/6WtwP+gqbr/maCt/5eeq/+Um6b/jpWe/42Smv+LkJf/iY+W/4mOlf+GipD/g4iN/4OIjv+AhYv/g4aK/36Bhv9UpuH/Rbf4/wqk9f8Al/L/AI/v/wCM7f8AiOr/AIPl/wB43P8BZsz/cqvX/5GWnv+NkZn/i5CY/4yRmf+OlJ7/pa2+/6Oru/+do7H/lp6r/5abpf+Rl6H/jZKa/4uQmP+GjJP/iI2T/4aLkP+Chov/gYaM/3+Eiv9/g4j/en6E/1il2/+W0vn/Ja33/wCa8/8AkfD/AI3u/wCI6v8AgeX/AHXb/zx9z/99s9j/kZae/4yQmP+MkJj/np6j/5SXoP+krL7/pq7A/52ltf+Xnqv/lJql/5SZo/+Rl6D/jpWf/4iNlf+DiZD/hYqQ/4OIjf+EiI7/gYWK/3yBhv95fYP/bpW0/5DP+v9Gtff/AaD0/wCZ8v8Aj+7/AIrr/wCA5f8XeNv/b6zb/4ugtP+Ok53/hYyV/46Sm/+TmKH/kpeg/6GntP+jrcD/o6y+/5yjsP+Xnqr/lpym/5SZof+Qlp//iY+X/4eNlf+FiY//goiO/4KHjf+Aho3/f4OJ/3uAhf96f4T/VaTX/yqz+f8BpvX/AJ3y/wCV7/8Ajev/J4Tg/3Kcx/+Ipr//kZeh/4ySnv+NlJ//j5ip/5OZov+Tl6D/oKa0/5+ntv+hq73/n6e3/5yirv+eoq7/lZqk/5KXoP+Nkpr/iI6W/4eMk/+IjJL/iYyR/4KHjP9/hIn/fIGH/32Bhv97gIX/ZJW7/0Kh3/8xoOn/Q5nf/2WTx/+LlaX/kJWg/42UoP+Kk6L/kZqr/5Scqv+Pl6P/kZij/5CYpP+gqbj/nqa1/6Krvf+iqrr/nqW0/5mhrv+Zn6v/lZqi/42TnP+Nkpr/jI+V/4iMk/+Gi5H/homP/4SIjf9/g4n/fIKH/32Bhv96f4T/fYGH/4CEif+Bhoz/hYqR/4uRmv+Rmaf/l6Cx/46Zr/+WoLT/l6Cw/46Wo/+UmqX/k5mk/5Ker/+cpLT/o6u8/6Osvv+0t8T/n6Wz/5uhrP+Znab/lJmj/4+UnP+Mkpr/io+X/4iOlv+HjJP/houR/4OIjf+Jio3/foSK/36Eif9+hIn/gISL/4GHjv+HjZX/kpeh/5ags/+bp8D/lJys/5qjt/+Qmqr/jJSg/5Sbp/+Xnqv/k5ys/5Ser/+iqrr/o6y+/6GswP+bo7L/oKWy/6mrs/+WnKf/lJmh/46Unv+MkZn/io+Y/4iNlP+Gi5L/hYmQ/4SJkP+DiI//goeO/4OIj/+FiZD/iI2V/46Unf+Znqv/oKm8/6Wrvv+Ynqz/oKW1/4+Ypv+NlqT/maCs/5ugrP+Kk6H/laO5/5qisf+cpLX/o63B/6Stv/+cpbT/naOw/5qgrP+Xnaf/lJmj/5Oapf+QlqD/ipCY/4iNlf+Kjpb/iY2V/4aLkv+Gi5P/iI2V/4uQmf+Slp7/k5mk/5igrv+lq7r/m6Oz/52ks/+Wnq7/kZuq/5aerf+boq//lZyp/2RufeaZoKzymqOy8p2ltfKrtsjy0d3q8p+qvPKdpLLynqaz8qKotPKcoqzynKGr8pugqfKXnKXyk5mh8pOZo/KRl5/ykJWd8pCVnvKQlqDylJmi8pedp/Kco67yn6a18p6ltPKhp7XyoKm68pigsPKXoK7ynaWz8qGotfKiqbXyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="><link rel=canonical href=https://mattweidner.com/2023/04/13/position-strings.html><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
 <body>
 <center>
 <div style=width:780px;display:inline-block;padding:30px;border-radius:30px;text-align:left>
 <h1>"Position Strings" for Collaborative Lists and Text</h1>
 
 <p align=right><i>
 Matthew Weidner | Apr 13th, 2023
 <br>
 <a href=https://mattweidner.com/>Home</a> | <a href=https://mattweidner.com/feed.xml>RSS Feed</a>
 <br>
 Keywords: position-strings, collaborative text editing, CRDTs, fractional indexing, Fugue
 </i></p>
 
 <p>I recently published a new TypeScript library on npm: <a href=https://www.npmjs.com/package/position-strings>position-strings</a>.</p>
<p>You can read the docs there for full info, but basically, it provides “position strings” for use in collaborative lists or text strings. Each position string points to a specific list element (or text character), and the list order is given by the lexicographic order on position strings.</p>
<p>For example, a collaborative text editor using the library could represent the text <code class="language-plaintext highlighter-rouge">"Hello world"</code> as:</p>
<div class="language-ts highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=p>[</span>
  <span class=p>{</span> <span class=na>position</span><span class=p>:</span> <span class=dl>"</span><span class=s2>r95sU223.B</span><span class=dl>"</span><span class=p>,</span> <span class=na>char</span><span class=p>:</span> <span class=dl>'</span><span class=s1>H</span><span class=dl>'</span> <span class=p>},</span>
  <span class=p>{</span> <span class=na>position</span><span class=p>:</span> <span class=dl>"</span><span class=s2>r95sU223.D</span><span class=dl>"</span><span class=p>,</span> <span class=na>char</span><span class=p>:</span> <span class=dl>'</span><span class=s1>e</span><span class=dl>'</span> <span class=p>},</span>
  <span class=p>{</span> <span class=na>position</span><span class=p>:</span> <span class=dl>"</span><span class=s2>r95sU223.F</span><span class=dl>"</span><span class=p>,</span> <span class=na>char</span><span class=p>:</span> <span class=dl>'</span><span class=s1>l</span><span class=dl>'</span> <span class=p>},</span>
  <span class=p>{</span> <span class=na>position</span><span class=p>:</span> <span class=dl>"</span><span class=s2>r95sU223.H</span><span class=dl>"</span><span class=p>,</span> <span class=na>char</span><span class=p>:</span> <span class=dl>'</span><span class=s1>l</span><span class=dl>'</span> <span class=p>},</span>
  <span class=p>{</span> <span class=na>position</span><span class=p>:</span> <span class=dl>"</span><span class=s2>r95sU223.J</span><span class=dl>"</span><span class=p>,</span> <span class=na>char</span><span class=p>:</span> <span class=dl>'</span><span class=s1>o</span><span class=dl>'</span> <span class=p>},</span>
  <span class=p>{</span> <span class=na>position</span><span class=p>:</span> <span class=dl>"</span><span class=s2>r95sU223.N</span><span class=dl>"</span><span class=p>,</span> <span class=na>char</span><span class=p>:</span> <span class=dl>'</span><span class=s1> </span><span class=dl>'</span> <span class=p>},</span>
  <span class=p>{</span> <span class=na>position</span><span class=p>:</span> <span class=dl>"</span><span class=s2>r95sU223.N,Y2FsVQbt.B</span><span class=dl>"</span><span class=p>,</span> <span class=na>char</span><span class=p>:</span> <span class=dl>'</span><span class=s1>w</span><span class=dl>'</span> <span class=p>},</span>
  <span class=p>{</span> <span class=na>position</span><span class=p>:</span> <span class=dl>"</span><span class=s2>r95sU223.N,Y2FsVQbt.D</span><span class=dl>"</span><span class=p>,</span> <span class=na>char</span><span class=p>:</span> <span class=dl>'</span><span class=s1>o</span><span class=dl>'</span> <span class=p>},</span>
  <span class=p>{</span> <span class=na>position</span><span class=p>:</span> <span class=dl>"</span><span class=s2>r95sU223.N,Y2FsVQbt.F</span><span class=dl>"</span><span class=p>,</span> <span class=na>char</span><span class=p>:</span> <span class=dl>'</span><span class=s1>r</span><span class=dl>'</span> <span class=p>},</span>
  <span class=p>{</span> <span class=na>position</span><span class=p>:</span> <span class=dl>"</span><span class=s2>r95sU223.N,Y2FsVQbt.H</span><span class=dl>"</span><span class=p>,</span> <span class=na>char</span><span class=p>:</span> <span class=dl>'</span><span class=s1>l</span><span class=dl>'</span> <span class=p>},</span>
  <span class=p>{</span> <span class=na>position</span><span class=p>:</span> <span class=dl>"</span><span class=s2>r95sU223.N,Y2FsVQbt.J</span><span class=dl>"</span><span class=p>,</span> <span class=na>char</span><span class=p>:</span> <span class=dl>'</span><span class=s1>d</span><span class=dl>'</span> <span class=p>}</span>
<span class=p>]</span>
</code></pre></div></div>
<p>Here the array is sorted lexicographically by <code class="language-plaintext highlighter-rouge">position</code>. (The funny-looking substrings <code class="language-plaintext highlighter-rouge">"r95sU223"</code> and <code class="language-plaintext highlighter-rouge">"Y2FsVQbt"</code> are random IDs, used to ensure uniqueness when multiple users type concurrently.)</p>
<p>When the user types <code class="language-plaintext highlighter-rouge">','</code> between <code class="language-plaintext highlighter-rouge">"Hello "</code> and <code class="language-plaintext highlighter-rouge">"world"</code>, the text editor will ask the library for a new position string in between the positions of <code class="language-plaintext highlighter-rouge">' '</code> and <code class="language-plaintext highlighter-rouge">'w'</code>:</p>
<div class="language-ts highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=c1>// At the start of the app:</span>
<span class=k>import</span> <span class=p>{</span> <span class=nx>PositionSource</span> <span class=p>}</span> <span class=k>from</span> <span class=dl>"</span><span class=s2>position-strings</span><span class=dl>"</span><span class=p>;</span>
<span class=kd>const</span> <span class=nx>source</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PositionSource</span><span class=p>();</span>

<span class=c1>// When the user types between ' ' @ "r95sU223.N" and 'w' @ "r95sU223.N,Y2FsVQbt.B":</span>
<span class=kd>const</span> <span class=nx>newPos</span> <span class=o>=</span> <span class=nx>source</span><span class=p>.</span><span class=nx>createBetween</span><span class=p>(</span><span class=dl>"</span><span class=s2>r95sU223.N</span><span class=dl>"</span><span class=p>,</span> <span class=dl>"</span><span class=s2>r95sU223.N,Y2FsVQbt.B</span><span class=dl>"</span><span class=p>);</span>
<span class=c1>// newPos is "r95sU223.J,bLBGHJmO.B", which is indeed between:</span>
<span class=c1>// "r95sU223.N" &lt; "r95sU223.J,bLBGHJmO.B" &lt; "r95sU223.N,Y2FsVQbt.B".</span>
</code></pre></div></div>
<p>The text editor then adds <code class="language-plaintext highlighter-rouge">{ position: newPos, char: ',' }</code> to its array in sorted order. It also broadcasts this object to collaborators, who add it to their own arrays. Likewise, when the user deletes a character, the text editor broadcasts the deleted position and all collaborators delete its list entry.</p>
<p>Position-strings implements <a href=https://mattweidner.com/2022/02/10/collaborative-data-design.html#list-gap>the hard part</a> of a list CRDT, with a minimal, lightweight API. Unlike most CRDT implementations, position-strings doesn’t “own” the list state or store extra metadata<sup id=fnref:1 role=doc-noteref><a href=#fn:1 class=footnote rel=footnote>1</a></sup>; instead, you are free to store the positions and chars (or list values) wherever you like. For example, you could store each <code class="language-plaintext highlighter-rouge">{ position, char }</code> as a row in a cloud-synced database like Firebase Realtime DB - I provide an <a href=https://www.npmjs.com/package/position-strings#example-app>example app</a> that implements collaborative text editing this way.</p>
<blockquote>
 <p>You can also think of position-strings like <a href=https://www.figma.com/blog/realtime-editing-of-ordered-sequences/#fractional-indexing>fractional indexing</a>, but with a few extra features: global uniqueness, non-interleaving, and slower (logarithmic) length growth in sequences.</p>
</blockquote>
<p></p>
<p><br></p>
<p>The catch is that a list/text CRDT using position-strings will have more storage and network overhead than a dedicated data structure like <a href=https://docs.yjs.dev/api/shared-types/y.array><code class="language-plaintext highlighter-rouge">Y.Array</code></a>. In my <a href=https://www.npmjs.com/package/position-strings#performance>benchmarks</a>, the position strings are typically 10-100 characters long, so you’ll have at least 10-100 bytes of storage overhead per list element/text character. This is fine for short documents and simple apps, but could be a problem for fancier uses.</p>
<p>Under the hood, position-strings uses an optimized version of <a href=https://mattweidner.com/2022/10/21/basic-list-crdt.html#intro-string-implementation>Fugue’s string implementation</a>. You can read about the full algorithm <a href=https://github.com/mweidner037/position-strings/blob/master/algorithm.md>here</a>.</p>
<div class=footnotes role=doc-endnotes>
 <ol>
 <li id=fn:1 role=doc-endnote>
 <p>Except for a small amount of ephemeral, local state that you don’t need to store or broadcast - it only exists for the lifetime of a <code class="language-plaintext highlighter-rouge">PositionSource</code> object.&nbsp;<a href=#fnref:1 class=reversefootnote role=doc-backlink>↩</a></p>
 </li>
 </ol>
</div>
 
 
 <hr>
 <p style=color:grey;--darkreader-inline-color:#988f81 data-darkreader-inline-color>
 <a href=https://mattweidner.com/>Home</a>
 • Matthew Weidner
 • PhD student at CMU CSD
 • maweidne@andrew.cmu.edu
 • <a href=https://twitter.com/MatthewWeidner3 class=plainA>@MatthewWeidner3</a>
 </p>
 </div>
 </center>
 
 
 
